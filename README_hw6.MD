# hw6

ДЗ 6:
https://git-intern.digitalleague.ru/internship/home_work/-/blob/master/06_controllers.md

# Домашнее задание №6 к занятию по Rails Controllers

Необходимо написать метод `check` для `OrdersController`.

Входящие параметры: `cpu`, `ram`, `hdd_type`, `hdd_capacity`, `os`.

- `cpu`, `ram`, `hdd_capacity` - целые числа.
- `hdd_type` - возможные варианты `sata`, `sas`, `ssd`.
- `os` - возможные варианты `windows`, `linux`.

Требования:

1. Метод должен быть доступен только для аутентифицированных пользователей.
2. Метод должен получить список возможных конфигураций виртуальной машины из внешнего сервиса по адресу http://possible_orders.srv.w55.ru/. Пример доступной конфигурации:
    
    ```json
    {  "os": ["linux"],  "cpu": [1, 2, 4, 8, 16],  "ram": [1, 2, 4, 8, 16, 32],  "hdd_type": ["sata", "sas"],  "hdd_capacity": {    "sata": {      "from": 10,      "to": 100    },    "sas": {      "from": 20,      "to": 150    },  }}
    ```
    
3. Метод должен проверить соответствие переданных параметров одной из конфигураций полученной из внешнего сервиса.
4. Метод должен запросить цену у сервиса который вы написали в рамках [ДЗ 4 HTTP](notion://www.notion.so/internship/home_work/-/blob/master/04_http/README.md). Добавьте его как сервис в docker-compose.yml проекта.
5. Метод должен проверить наличие достаточного количества средств на балансе пользователя.
6. Если все проверки прошли успешно, то метод должен вернуть статус 200 и json содержащий:
    - `result` - поле содержащее true
    - `total` - стоимость заказа
    - `balance` - текущий баланс пользователя
    - `balance_after_transaction` - баланс после проведения операции
7. Если одна из проверок не прошла, или обращение к внешним сервисам завершилось неудачно, то метод должен вернуть json содержащий:
    - `result` - поле содержащее false
    - `error` - текстовое поле содержащее описание проблемы
8. Статус ответа должен зависеть от причины ошибки:
    - `503 Service Unavailable` - если ошибка доступа к внешней системе
    - `406 Not Acceptable` - если используется некорректная конфигурация ВМ или недостаточно средств
    - `401 Unauthorized` - если в текущей сессии нет имени пользователя или баланса

Тестировать запрос можно через браузер так как в случае использования curl весьма затруднительно передавать идентификатор сессии.